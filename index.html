<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Silver and Blood: Advanced Interactive Guide</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <!-- Chosen Palette: Gothic Harmony -->
    <!-- Application Structure Plan: A top-navigated, single-page application with distinct sections for different user goals. The structure starts with a high-level strategic summary, then allows users to dive into the core feature: an interactive, filterable Vassal Tier List. From there, users can explore related content like a deep dive into Game Mechanics (explained visually), practical Team Building examples (now expanded with a tabbed interface for different content types), detailed profiles of Top-Tier Vassals, and a new interactive Team Builder tool. This non-linear, task-oriented structure was chosen because players have different needs: a new player might start with Mechanics, while a veteran might jump straight to the Team Builder to theorycraft. The flow encourages exploration and makes finding specific information fast and intuitive. -->
    <!-- Visualization & Content Choices: 
        - Report Info: Comprehensive Vassal Tier List -> Goal: Organize, Compare, Explore -> Viz/Presentation Method: Interactive HTML table with filters, search, and character portraits. -> Interaction: Dropdown filters for Tier, Faction, Class; text search; clickable rows to show detailed modal with larger image and new Synergy section. -> Justification: Transforms a static data table into a powerful, user-driven tool for strategic planning. -> Library/Method: Vanilla JavaScript, Tailwind CSS.
        - Report Info: Core Game Mechanics -> Goal: Inform, Explain Relationships -> Viz/Presentation Method: Custom diagrams and a new "Damage Principles" text section. -> Interaction: Hover effects to highlight information, visual state changes. -> Justification: Makes abstract game mechanics tangible and easier to understand than dense paragraphs. -> Library/Method: HTML, Tailwind CSS.
        - Report Info: Team Building Principles -> Goal: Apply, Experiment -> Viz/Presentation Method: New interactive Team Builder tool. -> Interaction: Users select 5 Vassals; the UI provides real-time feedback on Faction bonuses, Blood Moon activation, and role balance. -> Justification: Allows players to actively apply the guide's principles and experiment with their own compositions in a hands-on way. -> Library/Method: Vanilla JavaScript.
        - Report Info: Content-Specific Needs -> Goal: Provide Examples -> Viz/Presentation Method: NEW expanded section with a tabbed UI to display 5+ team cards for different game modes (Campaign, Abyss, Raids). -> Interaction: Users click tabs to switch between content-specific team recommendations. -> Justification: Gives players concrete, optimized starting points for the game's most important PVE challenges without overwhelming them with a single long list. -> Library/Method: HTML, Tailwind CSS, Vanilla JS.
    -->
    <!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1C1917; /* stone-900 */
            color: #F5F5F4; /* stone-100 */
        }
        h1, h2, h3, h4 {
            font-family: 'Cinzel', serif;
        }
        .nav-link {
            transition: color 0.3s, border-color 0.3s;
        }
        .nav-link:hover {
            color: #DC2626; /* red-600 */
            border-color: #DC2626;
        }
        .filter-button, .close-button, .builder-button, .tab-button {
             background-color: #57534E; /* stone-600 */
             color: #F5F5F4;
             transition: background-color 0.3s;
        }
        .filter-button:hover, .close-button:hover, .builder-button:hover, .tab-button:hover, .tab-button.active {
            background-color: #991B1B; /* red-800 */
        }
        .tier-sss { background-color: #7f1d1d; border-left-color: #fca5a5; color: white; }
        .tier-s { background-color: #7c2d12; border-left-color: #fdba74; color: white; }
        .tier-a { background-color: #14532d; border-left-color: #86efac; color: white; }
        .tier-b { background-color: #1e3a8a; border-left-color: #93c5fd; color: white; }
        .tier-c { background-color: #374151; border-left-color: #9ca3af; color: white; }
        .tier-f { background-color: #1f2937; border-left-color: #6b7280; color: white; }
        .chart-container {
            position: relative; width: 100%; max-width: 400px; margin-left: auto; margin-right: auto; height: 350px; max-height: 400px;
        }
        .modal { display: none; animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }
        .hero-section {
            background-image: linear-gradient(to top, rgba(28,25,23,1) 0%, rgba(28,25,23,0) 50%), url('https://placehold.co/1400x600/1c1917/9ca3af?text=Silver+%26+Blood');
            background-size: cover; background-position: center;
        }
        .bg-card { background-color: #292524; } /* stone-800 */
        .bg-surface { background-color: #44403C; } /* stone-700 */
        .text-header { color: #fca5a5; } /* red-300 */
        .text-muted { color: #A8A29E; } /* stone-400 */
        .team-builder-slot.empty {
            border: 2px dashed #57534E;
        }
        .team-builder-vassal.selected {
            outline: 2px solid #DC2626;
            transform: scale(0.9);
            opacity: 0.5;
        }
        .tab-panel { display: none; }
        .tab-panel.active { display: grid; }
    </style>
</head>
<body class="antialiased">

    <!-- Header & Navigation -->
    <header class="bg-stone-900/80 backdrop-blur-sm sticky top-0 z-40 w-full shadow-lg">
        <nav class="container mx-auto px-4 py-3 flex justify-between items-center">
            <a href="#" class="text-2xl font-bold text-stone-100 font-cinzel">Silver & Blood Guide</a>
            <div class="hidden md:flex items-center space-x-6">
                <a href="#overview" class="nav-link text-stone-300 border-b-2 border-transparent pb-1">Overview</a>
                <a href="#tier-list" class="nav-link text-stone-300 border-b-2 border-transparent pb-1">Tier List</a>
                <a href="#mechanics" class="nav-link text-stone-300 border-b-2 border-transparent pb-1">Mechanics</a>
                <a href="#team-compositions" class="nav-link text-stone-300 border-b-2 border-transparent pb-1">Compositions</a>
                <a href="#team-builder" class="nav-link text-stone-300 border-b-2 border-transparent pb-1">Team Builder</a>
            </div>
            <button id="mobile-menu-button" class="md:hidden text-stone-100">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7"></path></svg>
            </button>
        </nav>
        <div id="mobile-menu" class="hidden md:hidden bg-stone-900">
             <a href="#overview" class="block text-stone-300 text-center py-2">Overview</a>
             <a href="#tier-list" class="block text-stone-300 text-center py-2">Tier List</a>
             <a href="#mechanics" class="block text-stone-300 text-center py-2">Mechanics</a>
             <a href="#team-compositions" class="block text-stone-300 text-center py-2">Compositions</a>
             <a href="#team-builder" class="block text-stone-300 text-center py-2">Team Builder</a>
        </div>
    </header>

    <main>
        <!-- Hero Section -->
        <section id="hero" class="hero-section h-[40vh] md:h-[50vh] flex items-end justify-center text-center p-8">
             <div class="text-white">
                <h1 class="text-4xl md:text-6xl lg:text-7xl font-bold text-shadow-lg">Conquer Minexus</h1>
                <p class="text-lg md:text-xl mt-2 max-w-2xl">Your ultimate interactive guide to mastering every Vassal and strategy.</p>
            </div>
        </section>

        <div class="container mx-auto p-4 md:p-8">
            <section id="overview" class="my-12 scroll-mt-24">
                <h2 class="text-4xl md:text-5xl font-bold text-center mb-4 text-header">The Path to Power</h2>
                <p class="max-w-3xl mx-auto text-center text-lg text-stone-300">This guide illuminates the true nature of strategy in *Silver and Blood*. True power is forged before the first blow is struck, in the meticulous preparation of your team. Mastering the intricate synergies between Vassals—their Factions, Classes, and Moon Phases—is the ultimate expression of skill.</p>
            </section>

            <section id="tier-list" class="my-16 scroll-mt-24">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-2 text-header">Interactive PVE Tier List</h2>
                <p class="text-center text-muted mb-8 max-w-2xl mx-auto">Use the filters to find the perfect unit. Click any Vassal to see a detailed breakdown of their role, strategic value, and key synergies.</p>
                <div class="bg-surface p-4 rounded-lg shadow-md mb-8 grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 items-end">
                    <input type="text" id="name-search" placeholder="Search by name..." class="w-full p-2 rounded bg-stone-800 border border-stone-600 col-span-2 lg:col-span-2 text-white">
                    <div>
                        <label for="tier-filter" class="block text-sm font-medium text-muted mb-1">Tier</label>
                        <select id="tier-filter" class="w-full p-2 rounded bg-stone-800 border border-stone-600 text-white"><option value="all">All Tiers</option></select>
                    </div>
                    <div>
                        <label for="faction-filter" class="block text-sm font-medium text-muted mb-1">Faction</label>
                        <select id="faction-filter" class="w-full p-2 rounded bg-stone-800 border border-stone-600 text-white"><option value="all">All Factions</option></select>
                    </div>
                    <div>
                        <label for="class-filter" class="block text-sm font-medium text-muted mb-1">Class</label>
                        <select id="class-filter" class="w-full p-2 rounded bg-stone-800 border border-stone-600 text-white"><option value="all">All Classes</option></select>
                    </div>
                    <div>
                        <label for="moon-filter" class="block text-sm font-medium text-muted mb-1">Moon Phase</label>
                        <select id="moon-filter" class="w-full p-2 rounded bg-stone-800 border border-stone-600 text-white"><option value="all">All Phases</option></select>
                    </div>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-2 bg-card p-4 rounded-lg shadow-lg overflow-x-auto">
                        <table class="w-full min-w-[600px]">
                            <thead class="border-b-2 border-stone-600"><tr>
                                <th class="p-3 text-left text-sm font-semibold text-muted w-2/5">Vassal</th>
                                <th class="p-3 text-left text-sm font-semibold text-muted">Tier</th>
                                <th class="p-3 text-left text-sm font-semibold text-muted">Faction</th>
                                <th class="p-3 text-left text-sm font-semibold text-muted">Class</th>
                                <th class="p-3 text-left text-sm font-semibold text-muted">Moon Phase</th>
                            </tr></thead>
                            <tbody id="tier-list-body"></tbody>
                        </table>
                    </div>
                    <div class="lg:col-span-1 bg-card p-4 rounded-lg shadow-lg flex flex-col justify-center">
                         <h3 class="text-xl font-bold text-center mb-4">Filtered Vassal Distribution</h3>
                         <div class="chart-container"><canvas id="distribution-chart"></canvas></div>
                    </div>
                </div>
            </section>

            <section id="mechanics" class="my-16 scroll-mt-24">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-8 text-header">The Pillars of Power</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 gap-8">
                    <div class="bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-2xl font-bold mb-4 text-center">Core Synergies</h3>
                        <div class="space-y-4">
                            <div>
                                <h4 class="font-bold text-lg text-header">Factions</h4>
                                <p class="text-muted">Deploying multiple Vassals from the same Faction unlocks powerful passive stat boosts. Aim for a 3-2 split or a full 5-unit team.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-header">Classes</h4>
                                <p class="text-muted">A balanced warband is essential. A standard team needs a Defender, Enchanter, and DPS to handle all content.</p>
                            </div>
                            <div>
                                <h4 class="font-bold text-lg text-header">The Blood Moon</h4>
                                <p class="text-muted">The secret weapon. Including one of each Moon Phase (Waxing, Half, Full) in your team triggers the Blood Moon, reducing ultimate costs and boosting damage.</p>
                            </div>
                        </div>
                    </div>
                    <div class="bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-2xl font-bold mb-4 text-center">Damage Principles</h3>
                        <p class="text-muted mb-4">Damage is not a simple number. It's a combination of factors you can influence through strategic team building. Maximizing these is key to victory.</p>
                         <ul class="list-disc list-inside space-y-2 text-stone-300">
                            <li><strong class="text-white">Base Stats & Skills:</strong> A Vassal's core damage (Physical/Magical) multiplied by their skill effects.</li>
                            <li><strong class="text-white">Faction Bonuses:</strong> Flat percentage increases to stats from team synergy.</li>
                            <li><strong class="text-white">The Blood Moon Buff:</strong> A powerful team-wide damage multiplier. The most important buff to activate.</li>
                             <li><strong class="text-white">Enchanter Buffs:</strong> Temporary, high-impact boosts to Attack, Crit Rate, and Crit Damage from support units like Acappella.</li>
                            <li><strong class="text-white">Positional Bonuses:</strong> Character-specific passives, like Van Helsing's, that reward specific battlefield placement.</li>
                        </ul>
                    </div>
                </div>
            </section>
            
            <section id="team-compositions" class="my-16 scroll-mt-24">
                <h2 class="text-3xl md:text-4xl font-bold text-center mb-2 text-header">Optimized Team Compositions</h2>
                <p class="text-center text-muted mb-8 max-w-2xl mx-auto">Theory is nothing without practice. Here are optimized team formations for the game's key PVE challenges, demonstrating the principles of synergy in action.</p>
                
                <div class="mb-8 flex justify-center gap-2">
                    <button class="tab-button active px-4 py-2 rounded-md" data-tab="campaign">Campaign</button>
                    <button class="tab-button px-4 py-2 rounded-md" data-tab="abyss">Infinite Abyss</button>
                    <button class="tab-button px-4 py-2 rounded-md" data-tab="raids">Raids</button>
                </div>
                
                <!-- Campaign Teams -->
                <div id="panel-campaign" class="tab-panel active grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Cards will be populated here by JS -->
                </div>
                
                <!-- Abyss Teams -->
                <div id="panel-abyss" class="tab-panel grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                    <!-- Cards will be populated here by JS -->
                </div>

                <!-- Raid Teams -->
                <div id="panel-raids" class="tab-panel grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                   <!-- Cards will be populated here by JS -->
                </div>
            </section>
            
            <section id="team-builder" class="my-16 scroll-mt-24">
                 <h2 class="text-3xl md:text-4xl font-bold text-center mb-2 text-header">Interactive Team Builder</h2>
                <p class="text-center text-muted mb-8 max-w-2xl mx-auto">Theorycraft your perfect squad. Select five Vassals from the roster below and see an instant analysis of your team's synergies and balance.</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
                    <div class="lg:col-span-1 bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold mb-4">Your Team</h3>
                        <div id="team-builder-slots" class="grid grid-cols-5 gap-2 mb-4">
                            <!-- JS will populate empty slots -->
                        </div>
                        <h3 class="text-xl font-bold mb-4 mt-6">Synergy Analysis</h3>
                        <div id="team-analysis-report" class="space-y-3 text-stone-300">
                           <p>Select Vassals to begin analysis.</p>
                        </div>
                        <button id="reset-team-button" class="builder-button w-full mt-6 py-2 rounded">Reset Team</button>
                    </div>
                    <div class="lg:col-span-2 bg-card p-6 rounded-lg shadow-lg">
                        <h3 class="text-xl font-bold mb-4">Vassal Roster</h3>
                        <div id="team-builder-roster" class="grid grid-cols-4 sm:grid-cols-5 md:grid-cols-6 lg:grid-cols-8 gap-2 max-h-[500px] overflow-y-auto pr-2">
                           <!-- JS will populate roster -->
                        </div>
                    </div>
                </div>
            </section>
        </div>
    </main>
    
    <footer class="bg-stone-900 text-stone-500 text-center p-6 mt-16">
        <p>This interactive guide is based on the "Silver and Blood: A Strategic Analysis" report. Data sourced from pre-release and community analysis.</p>
    </footer>

    <div id="vassal-modal" class="modal fixed inset-0 bg-black bg-opacity-70 flex items-center justify-center p-4 z-50">
        <div class="bg-card w-full max-w-2xl mx-auto rounded-lg shadow-xl overflow-hidden border border-stone-700">
            <div id="modal-content" class="p-6"></div>
            <div class="bg-surface p-4 text-right">
                 <button id="modal-close-button" class="close-button px-4 py-2 rounded">Close</button>
            </div>
        </div>
    </div>

<script>
const vassalData = [
    { id:1, tier: 'SSS', name: 'Acappella', rarity: 'SSR', faction: 'Church', class: 'Enchanter', moon: 'Half Moon', image: 'https://placehold.co/150x150/fecaca/7f1d1d?text=Acappella' },
    { id:2, tier: 'SSS', name: 'Agares: Incendiary', rarity: 'SSR+', faction: 'Ancestors', class: 'Sorcerer', moon: 'Full Moon', image: 'https://placehold.co/150x150/fecaca/7f1d1d?text=Agares' },
    { id:3, tier: 'SSS', name: 'Ami: Transcendent', rarity: 'SSR+', faction: 'Ancestors', class: 'Guardian', moon: 'Waxing Moon', image: 'https://placehold.co/150x150/fecaca/7f1d1d?text=Ami' },
    { id:4, tier: 'SSS', name: 'Lamia', rarity: 'SSR', faction: 'Kingdom', class: 'Sorcerer', moon: 'Full Moon', image: 'https://placehold.co/150x150/fecaca/7f1d1d?text=Lamia' },
    { id:5, tier: 'SSS', name: 'Noah: Transcendent', rarity: 'SSR+', faction: 'Ancestors', class: 'Hunter', moon: 'Half Moon', image: 'https://placehold.co/150x150/fecaca/7f1d1d?text=Noah' },
    { id:6, tier: 'SSS', name: 'Seth', rarity: 'SSR', faction: 'Ancestors', class: 'Enchanter', moon: 'Waxing Moon', image: 'https://placehold.co/150x150/fecaca/7f1d1d?text=Seth' },
    { id:7, tier: 'SSS', name: 'Van Helsing', rarity: 'SSR', faction: 'Church', class: 'Hunter', moon: 'Full Moon', image: 'https://placehold.co/150x150/fecaca/7f1d1d?text=Van+Helsing' },
    { id:8, tier: 'S', name: 'Ami', rarity: 'SSR', faction: 'Kingdom', class: 'Enchanter', moon: 'Half Moon', image: 'https://placehold.co/150x150/fed7aa/7c2d12?text=Ami' },
    { id:9, tier: 'S', name: 'Bella', rarity: 'SSR', faction: 'Bloodborn', class: 'Sorcerer', moon: 'Full Moon', image: 'https://placehold.co/150x150/fed7aa/7c2d12?text=Bella' },
    { id:10, tier: 'S', name: 'Darcias', rarity: 'SSR', faction: 'Church', class: 'Warrior', moon: 'Half Moon', image: 'https://placehold.co/150x150/fed7aa/7c2d12?text=Darcias' },
    { id:11, tier: 'S', name: 'Gilrain', rarity: 'SSR', faction: 'Kingdom', class: 'Assassin', moon: 'Half Moon', image: 'https://placehold.co/150x150/fed7aa/7c2d12?text=Gilrain' },
    { id:12, tier: 'S', name: 'Hati: Transcendent', rarity: 'SSR+', faction: 'Ancestors', class: 'Warrior', moon: 'Full Moon', image: 'https://placehold.co/150x150/fed7aa/7c2d12?text=Hati' },
    { id:13, tier: 'A', name: 'Hati', rarity: 'SSR', faction: 'Kingdom', class: 'Assassin', moon: 'Half Moon', image: 'https://placehold.co/150x150/bbf7d0/14532d?text=Hati' },
    { id:14, tier: 'A', name: 'Jestel', rarity: 'SR', faction: 'Bloodborn', class: 'Guardian', moon: 'Waxing Moon', image: 'https://placehold.co/150x150/bbf7d0/14532d?text=Jestel' },
    { id:15, tier: 'A', name: 'Selena', rarity: 'SR', faction: 'Church', class: 'Hunter', moon: 'Full Moon', image: 'https://placehold.co/150x150/bbf7d0/14532d?text=Selena' },
    { id:16, tier: 'B', name: 'Aiona', rarity: 'SR', faction: 'Bloodborn', class: 'Enchanter', moon: 'Waxing Moon', image: 'https://placehold.co/150x150/bfdbfe/1e3a8a?text=Aiona' },
    { id:17, tier: 'B', name: 'Empousa', rarity: 'SR', faction: 'Bloodborn', class: 'Sorcerer', moon: 'Full Moon', image: 'https://placehold.co/150x150/bfdbfe/1e3a8a?text=Empousa' },
    { id:18, tier: 'B', name: 'Joan', rarity: 'SR', faction: 'Church', class: 'Warrior', moon: 'Half Moon', image: 'https://placehold.co/150x150/bfdbfe/1e3a8a?text=Joan' },
    { id:19, tier: 'S', name: 'Spectral Gilrain', rarity: 'SSR', faction: 'Bloodborn', class: 'Assassin', moon: 'Half Moon', image: 'https://placehold.co/150x150/fed7aa/7c2d12?text=Gilrain' },
    { id:20, tier: 'A', name: 'Augustine', rarity: 'SSR', faction: 'Bloodborn', class: 'Warrior', moon: 'Half Moon', image: 'https://placehold.co/150x150/bbf7d0/14532d?text=Augustine' },
    { id:21, tier: 'A', name: 'Cecia', rarity: 'SSR', faction: 'Kingdom', class: 'Sorcerer', moon: 'Full Moon', image: 'https://placehold.co/150x150/bbf7d0/14532d?text=Cecia' },
    { id:22, tier: 'S', name: 'Limine', rarity: 'SSR', faction: 'Ancestors', class: 'Sorcerer', moon: 'Full Moon', image: 'https://placehold.co/150x150/fed7aa/7c2d12?text=Limine' }
];

const vassalDetails = {
    'Joan': 'Discrepancy in ranking exists. Ranked SSS elsewhere, likely for PvP or early-game dominance. For PVE end-game, she is a solid early investment but falls off compared to specialized tanks. A versatile and resilient frontline unit.',
    'Van Helsing': 'Exemplifies positional strategy. Deals significantly more damage if no allies are in the two tiles in front of him, rewarding careful, high-risk team formations.',
    'Noah: Transcendent': 'Premier physical DPS who can also summon allies. These summons provide immense tactical value as blockers, decoys, or extra damage sources, offering unparalleled board control.',
    'Agares: Incendiary': 'The game\'s top AoE magical DPS. Essential for clearing waves of enemies quickly and efficiently. His high survivability makes him less reliant on constant protection.',
    'Acappella': 'The cornerstone of any top-tier team. Provides powerful healing and a suite of offensive and defensive buffs that multiply the effectiveness of the entire team. Arguably the highest priority Vassal to acquire.',
};

const vassalSynergies = {
    'Acappella': [ { name: 'Agares: Incendiary', reason: 'Provides the sustain needed for Agares to unleash his full AoE potential without fear.'}, { name: 'Ami: Transcendent', reason: 'Keeps the primary tank alive, forming an unbreakable defensive core.'} ],
    'Agares: Incendiary': [ { name: 'Acappella', reason: 'Her buffs and healing allow him to stay on the field longer, maximizing his damage output.' }, { name: 'Seth', reason: 'Dual-support from Seth ensures Agares can survive heavy focus fire while wiping enemy teams.' } ],
    'Van Helsing': [ { name: 'Ami: Transcendent', reason: 'Ami can hold the line while Van Helsing takes a solo forward position for his damage bonus.'}, { name: 'Noah: Transcendent', reason: 'Noah\'s summons can be placed strategically to protect Van Helsing without interfering with his positional passive.'} ]
};

const teamComps = {
    campaign: [
        { title: 'Standard & Sustainable', focus: 'Sustain & AoE', desc: 'A balanced team for clearing waves and handling diverse enemy types. Strong healing and AoE are key.', members: ['Joan', 'Agares: Incendiary', 'Selena', 'Acappella', 'Seth'] },
        { title: 'F2P Blood Moon Core', focus: 'Early Game Power', desc: 'Uses accessible Vassals to activate the crucial Blood Moon buff, giving new players a significant advantage.', members: ['Joan', 'Hati', 'Empousa', 'Aiona', 'Selena'] },
        { title: 'Ancestors Might', focus: 'Faction Dominance', desc: 'A powerful 3-2 Ancestors/Church split that combines top-tier AoE, summons, and healing for overwhelming force.', members: ['Ami: Transcendent', 'Agares: Incendiary', 'Noah: Transcendent', 'Acappella', 'Seth'] },
        { title: 'Church Resilience', focus: 'Extreme Survival', desc: 'This team focuses on outlasting any enemy with a strong Church core, featuring a tough tank and multiple healers/buffers.', members: ['Joan', 'Darcias', 'Van Helsing', 'Selena', 'Acappella'] },
        { title: 'Kingdom\'s Gambit', focus: 'Mixed Damage & Control', desc: 'Leverages the strong DPS and support options from the Kingdom faction, creating a versatile and hard-hitting lineup.', members: ['Ami', 'Gilrain', 'Hati', 'Lamia', 'Cecia'] }
    ],
    abyss: [
        { title: 'Burst & Control', focus: 'Burst Damage & Summons', desc: 'Maximum damage output to beat timers, with summons for tactical blocking and control on tough floors.', members: ['Ami: Transcendent', 'Noah: Transcendent', 'Spectral Gilrain', 'Acappella', 'Lamia'] },
        { title: 'Full Ancestors Assault', focus: 'Pure Faction Power', desc: 'Commits to a 5-man Ancestors team for the maximum faction bonus, resulting in incredible stats and damage.', members: ['Ami: Transcendent', 'Hati: Transcendent', 'Agares: Incendiary', 'Noah: Transcendent', 'Seth'] },
        { title: 'Mage Annihilation', focus: 'AoE Magical Burst', desc: 'Stacks the game\'s best Sorcerers to obliterate enemy waves with overwhelming magical power. Requires strong support.', members: ['Ami: Transcendent', 'Agares: Incendiary', 'Lamia', 'Limine', 'Acappella'] },
        { title: 'Assassin\'s Strike', focus: 'Backline Elimination', desc: 'Uses multiple assassins to bypass the enemy frontline and quickly eliminate high-priority threats like healers or mages.', members: ['Ami: Transcendent', 'Gilrain', 'Spectral Gilrain', 'Hati', 'Acappella'] },
        { title: 'Bloodborn Fury', focus: 'High-Risk Offense', desc: 'A team built around the aggressive Bloodborn faction, relying on their powerful offensive capabilities to win quickly.', members: ['Jestel', 'Augustine', 'Bella', 'Spectral Gilrain', 'Aiona'] }
    ],
    raids: [
        { title: 'Positional Supremacy', focus: 'Single-Target & Survival', desc: 'Built to burn down a single, high-health boss. Positional damage and dual healers are crucial for survival.', members: ['Ami: Transcendent', 'Van Helsing', 'Lamia', 'Acappella', 'Seth'] },
        { title: 'The Unbreakable Wall', focus: 'Maximum Sustain', desc: 'A hyper-defensive setup with a top-tier tank and dual healers, designed to survive the most devastating boss attacks.', members: ['Ami: Transcendent', 'Agares: Incendiary', 'Noah: Transcendent', 'Acappella', 'Seth'] },
        { title: 'Ultimate Firestorm', focus: 'Blood Moon Spam', desc: 'This team perfectly aligns the Blood Moon and leverages Vassals with high damage ultimates to create a constant barrage of power.', members: ['Ami: Transcendent', 'Van Helsing', 'Lamia', 'Acappella', 'Noah: Transcendent'] },
        { title: 'Church\'s Holy Fire', focus: 'Factional DPS', desc: 'A 3-2 Church/Ancestors team focusing on the raw single-target damage of Van Helsing, amplified by strong Church support.', members: ['Ami: Transcendent', 'Van Helsing', 'Darcias', 'Acappella', 'Seth'] },
        { title: 'Assassin’s Gambit', focus: 'High Crit Damage', desc: 'Focuses on the high single-target burst of assassins, ideal for bosses without minions. Needs strong healing to survive.', members: ['Ami: Transcendent', 'Gilrain', 'Spectral Gilrain', 'Acappella', 'Seth'] }
    ]
};


document.addEventListener('DOMContentLoaded', () => {
    const elements = {
        tierListBody: document.getElementById('tier-list-body'), nameSearch: document.getElementById('name-search'),
        tierFilter: document.getElementById('tier-filter'), factionFilter: document.getElementById('faction-filter'),
        classFilter: document.getElementById('class-filter'), moonFilter: document.getElementById('moon-filter'),
        modal: document.getElementById('vassal-modal'), modalContent: document.getElementById('modal-content'),
        modalCloseButton: document.getElementById('modal-close-button'), mobileMenuButton: document.getElementById('mobile-menu-button'),
        mobileMenu: document.getElementById('mobile-menu'), teamBuilderSlots: document.getElementById('team-builder-slots'),
        teamAnalysisReport: document.getElementById('team-analysis-report'), teamBuilderRoster: document.getElementById('team-builder-roster'),
        resetTeamButton: document.getElementById('reset-team-button'),
        tabs: document.querySelectorAll('.tab-button'),
        panels: document.querySelectorAll('.tab-panel')
    };

    const state = {
        tierOrder: ['SSS', 'S', 'A', 'B', 'C', 'F'],
        factionOrder: ['Ancestors', 'Church', 'Bloodborn', 'Kingdom'],
        classOrder: ['Guardian', 'Warrior', 'Assassin', 'Hunter', 'Sorcerer', 'Enchanter'],
        moonOrder: ['Waxing Moon', 'Half Moon', 'Full Moon'],
        team: []
    };
    
    let distributionChart;

    function populateFilters() {
        state.tierOrder.forEach(tier => { elements.tierFilter.innerHTML += `<option value="${tier}">${tier}</option>`; });
        state.factionOrder.forEach(faction => { elements.factionFilter.innerHTML += `<option value="${faction}">${faction}</option>`; });
        state.classOrder.forEach(cls => { elements.classFilter.innerHTML += `<option value="${cls}">${cls}</option>`; });
        state.moonOrder.forEach(moon => { elements.moonFilter.innerHTML += `<option value="${moon}">${moon}</option>`; });
    }

    function renderTable(filteredData) {
        elements.tierListBody.innerHTML = '';
        if (filteredData.length === 0) {
            elements.tierListBody.innerHTML = `<tr><td colspan="5" class="text-center p-8 text-muted">No Vassals match filters.</td></tr>`;
            return;
        }
        filteredData.sort((a, b) => {
            const tierDiff = state.tierOrder.indexOf(a.tier) - state.tierOrder.indexOf(b.tier);
            return tierDiff !== 0 ? tierDiff : a.name.localeCompare(b.name);
        });
        filteredData.forEach(vassal => {
            const row = document.createElement('tr');
            row.className = `border-b border-stone-700 hover:bg-stone-700/50 cursor-pointer tier-${vassal.tier.toLowerCase()} border-l-4 align-middle`;
            row.innerHTML = `
                <td class="p-3"><div class="flex items-center">
                    <img src="${vassal.image}" alt="${vassal.name}" class="w-12 h-12 rounded-md mr-4 object-cover shadow-sm" onerror="this.onerror=null;this.src='https://placehold.co/80x80/2d2d2d/f0f0f0?text=N/A';">
                    <div><div class="font-bold">${vassal.name}</div><div class="text-sm text-muted">${vassal.rarity}</div></div>
                </div></td>
                <td class="p-3"><span class="font-bold text-sm">${vassal.tier}</span></td><td class="p-3">${vassal.faction}</td>
                <td class="p-3">${vassal.class}</td><td class="p-3">${vassal.moon}</td>
            `;
            row.addEventListener('click', () => showModal(vassal));
            elements.tierListBody.appendChild(row);
        });
    }
    
    function showModal(vassal) {
        elements.modal.style.display = 'flex';
        const detailText = vassalDetails[vassal.name] || 'A capable Vassal effective in their designated role.';
        const synergies = vassalSynergies[vassal.name];
        let synergyHTML = '';
        if (synergies) {
            synergyHTML = `<h4 class="font-bold text-lg mt-4 mb-2 text-header">Key Synergies</h4><div class="space-y-2">`;
            synergies.forEach(syn => {
                const partner = vassalData.find(v => v.name === syn.name);
                if(partner){
                    synergyHTML += `<div class="flex items-center bg-surface p-2 rounded-md"><img src="${partner.image}" alt="${partner.name}" class="w-8 h-8 rounded-full mr-3"><div><p class="font-bold text-sm">${partner.name}</p><p class="text-xs text-muted">${syn.reason}</p></div></div>`;
                }
            });
            synergyHTML += `</div>`;
        }
        elements.modalContent.innerHTML = `
            <div class="flex flex-col md:flex-row gap-6"><div class="md:w-1/3 flex-shrink-0"><img src="${vassal.image}" alt="${vassal.name}" class="w-full h-auto rounded-lg shadow-lg object-cover" onerror="this.onerror=null;this.src='https://placehold.co/150x150/2d2d2d/f0f0f0?text=N/A';"></div><div class="flex-grow"><h3 class="text-3xl font-bold mb-2 font-cinzel text-white">${vassal.name}</h3><div class="flex flex-wrap gap-x-4 gap-y-2 mb-4 text-muted"><span><strong>Tier:</strong> ${vassal.tier}</span><span><strong>Faction:</strong> ${vassal.faction}</span><span><strong>Class:</strong> ${vassal.class}</span><span><strong>Moon:</strong> ${vassal.moon}</span></div><h4 class="font-bold text-lg mt-4 mb-2 text-header">Strategic Analysis</h4><p class="text-stone-300">${detailText}</p>${synergyHTML}</div></div>`;
    }

    function hideModal() { elements.modal.style.display = 'none'; }

    function renderChart(filteredData) {
        const ctx = document.getElementById('distribution-chart').getContext('2d');
        const distribution = filteredData.reduce((acc, vassal) => {
            const key = elements.factionFilter.value !== 'all' ? vassal.class : vassal.faction;
            acc[key] = (acc[key] || 0) + 1;
            return acc;
        }, {});
        if (distributionChart) { distributionChart.destroy(); }
        Chart.defaults.color = '#d6d3d1';
        distributionChart = new Chart(ctx, { type: 'doughnut', data: { labels: Object.keys(distribution), datasets: [{ label: 'Vassal Distribution', data: Object.values(distribution), backgroundColor: [ '#7f1d1d', '#7c2d12', '#14532d', '#1e3a8a', '#374151', '#4b5563'], borderColor: '#292524', borderWidth: 4, }]}, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } } });
    }

    function filterAndRender() {
        const queries = { name: elements.nameSearch.value.toLowerCase(), tier: elements.tierFilter.value, faction: elements.factionFilter.value, class: elements.classFilter.value, moon: elements.moonFilter.value };
        const filtered = vassalData.filter(v => (queries.name === '' || v.name.toLowerCase().includes(queries.name)) && (queries.tier === 'all' || v.tier === queries.tier) && (queries.faction === 'all' || v.faction === queries.faction) && (queries.class === 'all' || v.class === queries.class) && (queries.moon === 'all' || v.moon === queries.moon) );
        renderTable(filtered);
        renderChart(filtered);
    }
    
    function initTeamBuilder() {
        renderTeamSlots(); renderRoster();
        elements.resetTeamButton.addEventListener('click', () => { state.team = []; updateTeamBuilder(); });
    }

    function renderTeamSlots() {
        elements.teamBuilderSlots.innerHTML = '';
        for (let i = 0; i < 5; i++) {
            const slot = document.createElement('div');
            slot.className = 'team-builder-slot empty aspect-square flex items-center justify-center rounded-lg bg-surface';
            if(state.team[i]){
                const vassal = state.team[i];
                slot.classList.remove('empty');
                slot.innerHTML = `<img src="${vassal.image}" alt="${vassal.name}" class="w-full h-full object-cover rounded-lg" title="${vassal.name}">`;
                slot.addEventListener('click', () => removeVassalFromTeam(vassal.id));
            }
            elements.teamBuilderSlots.appendChild(slot);
        }
    }

    function renderRoster() {
        elements.teamBuilderRoster.innerHTML = '';
        vassalData.forEach(vassal => {
            const rosterItem = document.createElement('div');
            rosterItem.className = 'team-builder-vassal cursor-pointer transition-transform duration-200 hover:scale-110';
            rosterItem.innerHTML = `<img src="${vassal.image}" alt="${vassal.name}" class="w-full h-full object-cover rounded-md">`;
            if (state.team.some(v => v.id === vassal.id)) { rosterItem.classList.add('selected'); }
            rosterItem.addEventListener('click', () => addVassalToTeam(vassal.id));
            elements.teamBuilderRoster.appendChild(rosterItem);
        });
    }
    
    function addVassalToTeam(id) {
        if (state.team.length < 5 && !state.team.some(v => v.id === id)) {
            const vassal = vassalData.find(v => v.id === id);
            state.team.push(vassal); updateTeamBuilder();
        }
    }

    function removeVassalFromTeam(id) { state.team = state.team.filter(v => v.id !== id); updateTeamBuilder(); }
    
    function updateTeamBuilder() { renderTeamSlots(); renderRoster(); analyzeTeam(); }
    
    function analyzeTeam() {
        if (state.team.length === 0) { elements.teamAnalysisReport.innerHTML = '<p class="text-muted">Select Vassals to begin analysis.</p>'; return; }
        let report = '';
        const factions = state.team.reduce((acc, v) => { acc[v.faction] = (acc[v.faction] || 0) + 1; return acc; }, {});
        report += `<div><strong class="text-header">Faction Synergy:</strong> `;
        const factionBonuses = Object.entries(factions).filter(([_, count]) => count >= 2);
        if(factionBonuses.length > 0) { report += factionBonuses.map(([faction, count]) => `${faction} x${count}`).join(', '); } else { report += `<span class="text-yellow-400">None Active</span>`; }
        report += `</div>`;
        const moons = new Set(state.team.map(v => v.moon));
        report += `<div><strong class="text-header">Blood Moon:</strong> `;
        if (moons.has('Waxing Moon') && moons.has('Half Moon') && moons.has('Full Moon')) { report += `<span class="text-green-400">ACTIVATED!</span> (Ultimate costs reduced)`; } else { report += `<span class="text-yellow-400">Not Active. Missing ${['Waxing Moon', 'Half Moon', 'Full Moon'].filter(m => !moons.has(m)).join(', ')}</span>`; }
        report += `</div>`;
        const roles = state.team.reduce((acc, v) => { acc[v.class] = (acc[v.class] || 0) + 1; return acc; }, {});
        report += `<div><strong class="text-header">Role Balance:</strong> ${Object.entries(roles).map(([role, count]) => `${role} x${count}`).join(', ')}</div>`;
        let summary = '';
        const tankCount = roles['Guardian'] || 0; const healerCount = roles['Enchanter'] || 0;
        const dpsCount = (roles['Warrior'] || 0) + (roles['Assassin'] || 0) + (roles['Hunter'] || 0) + (roles['Sorcerer'] || 0);
        if (tankCount === 0) summary += '<li>Warning: No Guardian for protection.</li>';
        if (healerCount === 0) summary += '<li>Warning: No Enchanter for healing.</li>';
        if (dpsCount < 2) summary += '<li>Warning: Low damage output.</li>';
        if (healerCount === 2) summary += '<li>Insight: Strong dual-support core for high survivability.</li>';
        if (dpsCount >= 4) summary += '<li>Insight: Aggressive "glass cannon" composition.</li>';
        if(summary !== '') report += `<div><strong class="text-header">Summary:</strong><ul class="list-disc list-inside">${summary}</ul></div>`;
        elements.teamAnalysisReport.innerHTML = report;
    }
    
    function initTeamComps() {
        for (const [category, teams] of Object.entries(teamComps)) {
            const panel = document.getElementById(`panel-${category}`);
            if (!panel) continue;
            panel.innerHTML = teams.map(team => {
                const membersHTML = team.members.map(memberName => {
                    const vassal = vassalData.find(v => v.name === memberName);
                    return vassal ? `<div class="flex items-center text-sm"><img src="${vassal.image}" alt="${vassal.name}" class="w-6 h-6 rounded-full mr-2 object-cover"><span>${vassal.name}</span></div>` : '';
                }).join('');
                return `
                <div class="bg-surface p-6 rounded-lg shadow-lg">
                    <h3 class="text-lg font-bold mb-1">${team.title}</h3>
                    <p class="text-sm text-header mb-3">${team.focus}</p>
                    <p class="text-muted text-sm mb-4">${team.desc}</p>
                    <div class="space-y-2">${membersHTML}</div>
                </div>`;
            }).join('');
        }
    }
    
    function handleTabClick(e) {
        elements.tabs.forEach(tab => tab.classList.remove('active'));
        elements.panels.forEach(panel => panel.classList.remove('active'));
        
        const tabButton = e.currentTarget;
        tabButton.classList.add('active');
        const targetPanelId = `panel-${tabButton.dataset.tab}`;
        document.getElementById(targetPanelId).classList.add('active');
    }

    // Initial Setup
    populateFilters();
    filterAndRender();
    initTeamBuilder();
    initTeamComps();
    
    // Event Listeners
    [elements.nameSearch, elements.tierFilter, elements.factionFilter, elements.classFilter, elements.moonFilter].forEach(el => { el.addEventListener('input', filterAndRender); });
    elements.modalCloseButton.addEventListener('click', hideModal);
    elements.modal.addEventListener('click', (e) => { if (e.target === elements.modal) hideModal(); });
    elements.mobileMenuButton.addEventListener('click', () => { elements.mobileMenu.classList.toggle('hidden'); });
    elements.tabs.forEach(tab => tab.addEventListener('click', handleTabClick));
});
</script>
</body>
</html>
